<titledef text="Arrays">

<h2> 3.7 Arrays </h2>


<p>
  An <dfn>array</dfn> is a list of values, either all of the same type
  or of multiple types.  An array makes it easy to reference values by
  their number &mdash; for instance, it's easy to say &quot;give me
  the fourth value in the array&quot;.  However, an array is slow when
  you add values or remove them.
</p>

<p>
  Let's write a function to count digits in a string.  Go ahead and
  change <tt>myobj.c</tt> (or make a new file) to the following:
</p>

<pre>
mixed count_digits(string str) {
  int   *num_count;
  int    ctr;
  object user;

  num_count = allocate_int(10);

  for(ctr = 0; ctr &lt; strlen(str); ctr++) {
    if((str[ctr] &lt;= '9') &amp;&amp;
       (str[ctr] &gt;= '0')) {
      num_count[str[ctr] - '0']++;
    }
  }

  user = this_user();
  user-&gt;message(&quot;Count: [&quot;);
  for(ctr = 0; ctr &lt; 10; ctr++) {
    user-&gt;message(num_count[ctr] + &quot; &quot;);
  }
  user-&gt;message(&quot;]\n&quot;);
}
</pre>

<p>
  To call this file, first compile it.  So you'll type <kbd>compile
  /usr/admin/myobj.c</kbd>.  If you're not using <tt>myobj.c</tt> as
  the filename, substitute the one you're using.  You should get a
  result like <samp>$34 = &lt;/usr/admin/myobj&gt;</samp>.  Now, using
  the history variable you get back (we'll pretend it's $34 here),
  type <kbd>$34->count_digits(&quot;0123456789&quot;)</kbd>, or the
  equivalent with your own history variable number.  You should see a
  result like the following:
</p>

<pre>
Count: [1 1 1 1 1 1 1 1 1 1 ]
$36 = nil
</pre>

<p>
  Since the function doesn't explicitly return anything, the history
  variable result is <var>nil</var>.  But since the function calls
  <code>user-&gt;message</code> to send output to the user (that's
  you!), the list of number counts is printed out.  Try calling the
  function a few more times with arguments different from
  &quot;0123456789&quot;.  It will count the number of occurrences of
  each digit in your input.
</p>

<p>
  If you look at the line in the code starting with <code>mixed
  count_digits</code>, you'll notice that it's different from the code
  in the <a href="Tutorial_CodeInFiles">last section</a>.  It uses a
  different <dfn>function name</dfn>, <var>count_digits</var> instead
  of <var>exec</var>.  That's why you typed &quot;count_digits&quot;
  when calling the function.  You'll also notice that instead of
  having <code>object user, mixed argv...</code> in parentheses, it
  has <code>string str</code>.  That section tells what the function
  needs to do its thing.  For the &quot;return 7&quot; function, you
  called it with <code>this_user()</code>, a user object, in
  parentheses.  For <var>count_digits</var>, you gave a string which
  it then counted numbers in.
</p>

<p>
  There are two new types of variable declaration in the code to
  count_digits.  There is a variable type called <var>object</var>,
  like <var>mixed</var> or <var>int</var>.  A variable of type
  <var>object</var> will hold a compiled DGD object, such as a
  connection object, or the object that <tt>myobj.c</tt> compiles
  into.  In <var>count_digits</var>, it holds a user object like the
  one you passed to the function in the last section.
</p>

<p>
  You'll notice that the variable declaration for <var>num_count</var>
  starts with <var>int</var>, but that there's an asterisk in front of
  the variable name.  The asterisk means that <var>num_count</var>
  isn't an integer, but rather an <dfn>array</dfn> of integers.
</p>

<p>
  Defining <var>num_count</var> doesn't give it a value.  Arrays, like
  strings, are assigned <var>nil</var> by default, and have to be
  initialized to something.  One way to assign reasonable values to an
  array of integers is the allocate_int function, which returns an
  array of zeroes.  The array is as long as the number in parentheses
  is big.  For the example above, that means it returns an array of
  ten zeroes.
</p>

<p>
  There are a couple of other new things in the code above.  We'll
  tackle them one at a time.  The first is <code>++</code>, called the
  <dfn>increment</dfn> operator.  It adds one to whatever variable you
  use it on.  So if <var>a</var> was a variable, then <code>a++</code>
  means &quot;add one to <var>a</var>&quot;.
</p>

<p>
  Another is the zero in single quotes.  Remember that LPC characters
  are represented as ASCII-encoded integers.  A character in single
  quotes will evaluate the that character's integer.  Try typing
  <kbd>code 'A'</kbd> and you should get a result of 65, just like in
  the <a href="Tutorial_StringHandling">section on handling
  strings</a>.  The 'if' statement checks to make sure that the
  character is a number between 0 and 9.  That way letter, spaces and
  punctuation will be ignored.
</p>

<p>
  The final new feature of the code is the square brackets, called the
  <dfn>array dereference</dfn> operator.  The idea is that for an
  array, like a string, you can take a single element from it.  So if
  an array called <var>arr</var> contains a zero followed by four
  nines, then the value of <code>arr[0]</code> is zero, and the value
  of <code>arr[1]</code>, <code>arr[2]</code> and <code>arr[3]</code>
  would each be nine.  If you tried to check <code>arr[4]</code>,
  you'd get an error because there are only four elements and you
  tried to ask about the fifth one.
</p>

<p>
  In <code>num_count[str[ctr] - '0']++;</code>, the square brackets
  are used twice, one inside the other.  The first is to dereference a
  character of the string, just like before.  Then <code>'0'</code> is
  subtracted from that character.  The numbers 0 through 9, when ASCII
  encoded, become 48 through 57.  Since the numbers are in order,
  starting with zero, you can subtract ASCII zero (which equals the
  number 48) from an ASCII digit such as the ones you typed in, and
  get a number 0 through 9 for which digit it was.  That's why we
  subtract the character zero from that character of the string.
</p>

<p>
  The second dereference, the one outside, is an array dereference,
  not a string dereference, but they work the same way if you think of
  a string as being like an array of ASCII-encoded characters.  Since
  subtracting the character <code>'0'</code> leaves a number between 0
  and 9, we can then use that character as the <dfn>offset</dfn>
  within the array.  Since the array has ten elements, they're
  numbered 0 through 9.
</p>

<p>
  To write an array value in LPC, you surround the entries with
  parentheses and curly braces and separate the entries with commas.
  So the array mentioned above would be written <code>({ 0, 9, 9, 9, 9
  })</code> in LPC.  Instead of the allocate_int call, you could have
  written <code>num_count = ({ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 });</code>
  The curly braces have to be <em>inside</em> the parentheses, they
  can't be outside them.
</p>

<p>
  Arrays can also be added to each other like strings.  Adding them
  will make a new array which is all the elements of the first array
  followed by all the elements of the second array.  So <kbd>code ({
  1, 2, 3 }) + ({ 7, 8, 9 })</kbd> will print a result like <samp>$40
  = ({ 1, 2, 3, 7, 8, 9 })</samp>.
</p>



<table style="width: 100%; border: 1px">
  <tr>

    <td><a href="Tutorial_CodeInFiles.html"> &lt;&mdash; Prev<br /> Making and Using LPC Files </a></td>

    <td align="center"><a href="Tutorial.html"> Up<br /> A Quick LPC Tutorial </a></td>

    <td align="right"><a href="Tutorial_Mappings.html"> Next &mdash;&gt; <br />Mappings </a></td>
  </tr>
</table>
