<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Programming the DGD Driver: Making and Using LPC Files</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="http://phantasmal.sf.net/DGD/driverbook.css"
      rel="stylesheet" type="text/css" />
</head>
<body>
<table width="95%" border="0" cellspacing="0" cellpadding="4">
  <tr>
    <td colspan="2">
      <table width="100%" border="0" cellspacing="1"
        cellpadding="0" class="main">
        <tr>
          <td class="banner">Programming the DGD Driver</td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td valign="top">
      <table width="25%"  border="0" cellspacing="1"
             cellpadding="0"  class="main">
        <tr>
          <td class="content" style="font-size: 120%">

          <ul style="margin: 0; padding-left: 10%">
            <li> <a href="index.html">Table of Contents</a> </li>
	    <li> <a href="http://phantasmal.sf.net/DGD/index.html">
	         DGD &amp; LPC Page </a> </li>
          </ul>

        </td>
        </tr>
        <tr>
          <td class="content" align="center">
            <a href="http://validator.w3.org/check/referer">
            <img src="http://phantasmal.sf.net/images/valid-xhtml10.gif"
	     alt="Valid XHTML 1.0!"
             style="border:0;width:88px;height:31px" /></a><br />
            <img src="http://phantasmal.sf.net/images/pixel.gif"
             style="border:0;width:88px;height:1px" alt="" /><br />
            <a href="http://jigsaw.w3.org/css-validator/check/referer">
            <img src="http://jigsaw.w3.org/css-validator/images/vcss"
             alt="Valid CSS!" style="border:0;width:88px;height:31px" />
            </a><br /><br /><br />
            <a href="http://sourceforge.net">
            <img src="http://sourceforge.net/sflogo.php?group_id=48659&amp;type=2"
             style="border: 0; width: 125; height: 37;"
	     alt="SourceForge.net Logo" /></a>
          </td>
        </tr>
      </table></td>
    <td> <table width="100%"  border="0" cellspacing="1" cellpadding="0" 
          class="main">
        <tr>
          <td class="content">


<h2> 2.6 Making and Using LPC Files </h2>


<p>
  You may be getting pretty tired of the code command by now.  Even if
  you're not, you're probably starting to understand why we don't use
  it for big programs.  Retyping all that stuff can get ugly, and
  typos are difficult to correct.  And the code would certainly
  <em>look</em> better if it could be formatted properly...
</p>

<p>
  To start using LPC files, you'll first need to be able to edit files
  of source code somehow.  That means you'll need an editor.
</p>

<p>
  On Unix, essentially any editor will do.  On Windows, however,
  you'll need to be careful because most editors use Windows-style
  line breaks, which DGD doesn't use properly.  If you download a copy
  of TextPad, that editor will handle line breaks properly.  There are
  also versions of emacs and vi for Windows, and either will work.  Or
  you can use the <a href="Misc_EditorQuick.html">built-in DGD
  editor</a>, though that's generally less convenient.  I don't know
  the situation on Macintosh computers, so I don't know what editors
  are available.  In any case, no matter the platform, the built-in
  DGD editor will work fine.
</p>

<p>
  It's useful to know what the code command does so you can get your
  code to work similarly.  The code command makes a new object from a
  file every time you use it.  That file looks something like this:
</p>

<pre>
#include &lt;float.h&gt;
#include &lt;limits.h&gt;
#include &lt;status.h&gt;
#include &lt;trace.h&gt;
#include &lt;type.h&gt;

mixed exec(object user, mixed argv...) {
    mixed a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;

    &lt;Your Code&gt;
}
</pre>

<p>
  It's actually a little more complicated than that &mdash; for
  instance, a <code>return</code> statement is added before your code
  if that code doesn't end with a semicolon or end-curly-brace.  Also,
  your code has all the history references turned into something more
  palatable to LPC since the history variables aren't part of LPC
  proper.  They're only part of the code command.
</p>

<p>
  To create the LPC file, you'll need to use your editor to create a
  file called <tt>/usr/admin/myobj.c</tt>.  Note that that filename is
  relative to the directory of the Kernel Library, so if you installed
  DGD in <tt>C:\DGD</tt>, you'll need to make the file
  <tt>C:\DGD\mud\usr\admin\myobj.c</tt>.  If you installed dgd in
  <tt>/home/bob/dgd</tt>, you'll need to make the file
  <tt>/home/bob/dgd/mud/usr/admin/myobj.c</tt>.
</p>

<p>
  You should make an LPC file exactly like the above, except that
  where it says &quot;&lt;Your Code&gt;&quot;, you should substitute
  <code>return 7;</code>.  That way, the test object will return the
  number 7 when you call its function.  So you'll have created the
  object that the Kernel Library would create internally if you used
  the command <kbd>code 7</kbd>.
</p>

<p>
  Now you'll need to compile the object.  To do that, from admin's
  command line, you'll want to type <kbd>compile
  /usr/admin/myobj.c</kbd>.  You may just be able to type <kbd>compile
  myobj.c</kbd> for the same result &mdash; use the <kbd>pwd</kbd>
  command to make sure you're in the <tt>/usr/admin</tt> directory.
</p>

<p>
  In either case, you should see a result like <samp>$15 =
  &lt;/usr/admin/myobj&gt;</samp>.  If you get errors instead (other
  than file not found) then your code isn't quite right.  Look at it
  again carefully.  If it can't find the file, then perhaps you didn't
  put it in the right place, or perhaps you didn't type he compile
  line perfectly.  Check them both again.  Try it until you get the
  result above.
</p>

<p>
  Once you have, you've made a usable object.  To call a function on
  it, you'll want to use its history entry.  This command line will
  assume that the object was $15 (as in the paragraph above).  If
  yours was a different history number, you should substitute your own
  number.  Type <kbd>code $15-&gt;exec(this_user())</kbd>.  You should
  get a result like <samp>$16 = 7</samp>.  You've successfully
  returned the number 7.  Success!
</p>

<p>
  Go back and look at the code again.  You may have realized that the
  long line starting with <var>mixed</var> declares all those
  single-letter variables I mentioned earlier.  <code>Mixed</code> is
  declares a variable, just as <var>int</var> and <var>float</var> do.
  A <var>mixed</var> variable can hold any DGD type.  You
  <em>could</em> just make all of your variables mixed rather than
  bothering with all the different types.  But there are some serious
  disadvantages to doing that, as we'll discuss later on.
</p>

<p>
  DGD doesn't guarantee that variables like 'c' and 'f' are globally
  declared.  The code command chooses to provide them.  Constants like
  <var>ST_VERSION</var> aren't really part of the language either.
  They're included by the series of <code>#include</code> directives
  at the start of the source file.  In your own code, you'll need to
  specifically include the files for any constants you may wish to
  use.
</p>

<p>
  We'll cover more about the specifics of that file and what we mean
  by a function later on.  Similarly, we'll cover more about why you
  had to call it with the syntax you did.  However, in the mean time,
  you have a good simple way to store your code and make modifications
  to it instead of retyping the whole thing every time.  That'll be
  useful for code like what you typed in the <a
  href="Tutorial_Loops.html">Loops and Looping</a> section.
</p>


<table style="width: 100%; border: 1px">
  <tr>

    <td><a href="Tutorial_UserOutput.html"> &lt;&mdash; Prev<br /> Sending Output to the User </a></td>

    <td align="center"><a href="Tutorial.html"> Up<br /> A Quick LPC Tutorial </a></td>

    <td align="right"><a href="Tutorial_Arrays.html"> Next &mdash;&gt; <br />Arrays </a></td>
  </tr>
</table>
            <address>
            <span><a href="mailto:angelbob-remove-spamfree@spamfree.users.sf.net">Noah Gibbs</a></span>
            </address></td>
        </tr>
      </table></td>
  </tr>
</table>
</body>
</html>
