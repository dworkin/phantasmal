@@TITLE Customizing DGD@@

<h2>Compiling and Customizing Your Copy of DGD</h2>

<ul>
  <li><a href="#Tools">Tools for working on DGD</a></li>

  <li><a href="#DGDExperimental">Making and patching an
  experimental version of DGD</a></li>

  <li><a href="#DGDCygwin">Making an experimental version of DGD
  under Win32 and Cygwin</a></li>

  <li><a href="#ANSIColor">Configuring DGD to use ANSI Color
  Codes</a></li>

  <li><a href="#StringSize">Increasing DGD's maximum string
  size</a></li>

  <li><a href="#NumObjects">Increasing DGD's maximum number of
  objects</a></li>
</ul>
<hr>
<a name="Tools" id="Tools"></a>

<h2>Tools for working on DGD</h2>

<h3>Tools on Unix</h3>

<p>Chances are you've already got what you need. You'll need a good
C compiler. GCC is perfect. You'll need a text editor that respects
Unix-style line breaks, like emacs, vi, or pretty much any other
normal Unix editor.</p>

<h3>Tools on Windows</h3>

<ul>
  <li>For utilities like grep and patch the <a href=
  "http://sources.redhat.com/cygwin/">Cygnus Cygwin tools</a> are
  excellent. You'll definitely want them if you're using the
  experimental branch of DGD even if you compile with Visual C++ or
  another non-GNU compiler. They also come with a Windows version
  of GCC, which may be worth considering. If you compile with
  Cygwin's GCC, remember to use 'DMAKE=gmake' or whatever you
  choose to call CygWin make. Basically, you'll need to let DGD's
  makefile know what tools to use if any of them don't have the
  standard names.</li>

  <li><a href="http://www.textpad.com">Textpad</a> is supposed to
  be a fine editor, and it has the advantage that it'll handle DGD
  and unix-style line breaks correctly. If you use J. Random Editor
  on Windows you'll probably find that the file just doesn't
  compile. Textpad fixes that problem. You can also use the
  <a href="http://www.crimsoneditor.com/">Crimson Editor</a>, which
  autodetects the kind of line breaks that a given document
  uses.</li>

  <li>If you're using CVS to get <i>really</i> experimental
  versions of software you use with DGD (for instance, the <a href=
  "http://phantasmal.sourceforge.net">Phantasmal</a> MUDLib), you
  should also be aware that the native Win32 version of CVS may
  cause problems with line endings (newlines). If you have troubles
  with the CVS versions of the software but not the regular
  distributions, consider using the Cygwin CVS client instead of
  the Win32 native client.</li>

  <li>In addition, for TortoiseCVS, there's a <a href=
  "http://sourceforge.net/docman/display_doc.php?docid=25888&amp;group_id=1">
  SourceForge tutorial on how to set it up for SourceForge
  projects.</a></li>
</ul>
<hr>
<pre>
@@INCLUDE tools@@
</pre>
<hr>
<a name="DGDExperimental" id="DGDExperimental"></a>

<h2>Making an Experimental Version of DGD</h2>

<p>To patch up to an experimental version of DGD, say one of the
1.2.X series, first you'll need to <a href="#DGDPackages">get
DGD</a> . The latest version is definitely best if you're going to
patch up to an experimental version, unless you need some very
specific older version like 1.1.96. You'll also need to download
the whole set of <a href=
"ftp://ftp.dworkin.nl/pub/dgd/experimental">experimental
patches</a> from the version of the code you <i>have</i> up to the
version you <i>want</i>. Then, if you've got Unix and patch, or if
you've got the <a href="http://sources.redhat.com/cygwin/">Cygnus
Cygwin tools</a> under Windows (they also supply the patch utility)
you'll want to type in a whole lot of lines like the ones below.
When you type them you should be in the same directory where you
first untarred or unzipped the DGD source:</p>
<pre>
@@INCLUDE patching@@
</pre>

<p>You'll need all those files on the right, the ones with names
like "1.2.1-1.2.2". Be sure to unzip or ungzip them if they're
compressed when you download them. Netscape may do this for you --
that's what's happened if you download 1.2.1-1.2.2.gz and Netscape
offers to save it without the ".gz". Each one takes you up one
experimental release, so to patch up to 1.2.22 above took 22
patches from 1.2. And this is all <i>before</i> you get around to
building it. Be sure to play with a stable version before you take
the plunge the first time on the experimental one.</p>

<p>Note that you'll need to do all of this patching <i>before</i>
you build DGD to be sure everything works. On the bright side,
under Unix you may be able to avoid typing all those lines -- try
just typing "patch -p 0 &lt; 1.2.*" in a directory containing the
unzipped patchfiles. If you try it and it starts giving you
rejected patches then something's wrong. If that happens, you
should go back to trying it the long (but certain) way.</p>

<p>And a final note: if you're the sort that grabs the experimental
version, you may be rebuilding from nothing, or you may be altering
the lex/yacc files for some reason. If you're using a nonstandard
version of Yacc (for instance bison) you can type "YACC=myyacc"
after the make command and it'll use the appropriate version. For
bison, you'll need to pass a command-line flag to make it output
the appropriate filename. For me, that command line winds up being
"make YACC='bison -o y.tab.c'"</p>
<hr>
<a name="DGDCygwin" id="DGDCygwin"></a>

<h2>Making an Experimental Version of DGD with Cygwin</h2>

<p>This is Will Shattuck's set of instructions for compiling DGD
version 1.2.47 under Cygwin. It should be pretty adaptable for
other DGD versions.</p>
<pre>
@@INCLUDE will_shattuck@@
</pre>
<hr>
<a name="ANSIColor" id="ANSIColor"></a>

<h2>How do I set up DGD to work with ANSI color?</h2>

<p>First, you should get and configure DGD without ANSI color. Make
sure you have DGD working with your other options before worrying
about color. One option at a time is always your best bet.</p>

<p>Once you have DGD working with all other patches you want to use
(including the net package if you're planning to use it) you'll
need to get and install the ANSI Color package. Note that the ANSI
color package isn't guaranteed to work with the net package -- keep
reading anyway. The 'patch' utility will do your dirty work for you
if you can find an appropriate ANSI package for your DGD version.
Again, if you have the net package installed (or certain other
nonstandard patches) then you'll have to hand-patch it. To
hand-patch, you'll need to look for lines like this:</p>
<pre>
         } else if ((*p &amp; 0x7f) &lt; ' ' &amp;&amp; *p != HT &amp;&amp; *p != BEL &amp;&amp; *p != BS) {
    
</pre>

<p>There'll be one or more in .../src/comm.c, so start looking
there. You'll need to change the "0x7f" in the line above to 0xff
to let any high-ASCII characters through, or change the line in
some other way to let only specific characters through. Once you do
that, all should be smooth sailing. Incidentally, the there may be
problems if you let <i>all</i> high-ASCII characters through, which
is why DGD doesn't do it by default. You may want to be more
selective and just let the ones you care about through. The best
option is usually just to install the ANSI color package rather
than mucking around in the source unless you already know what
you're doing -- it'll let only the escape character (\033) through,
which is all you need for ANSI color.</p>

<p>To enable non-English character codes you'll need to hand-patch.
You can either do the 0xff hack above or specifically let through
the foreign character codes you plan to allow. You'll need to find
out their ASCII values or ranges and add them to the if
statement.</p>

<p>If you've got the net package installed, you'll need to search
comm.net.c for the same line and replace it where it occurs in that
file as well.</p>

<p>As of DGD 1.2.41, there's another possibility if you're willing
to play with telnet codes, or if you don't care about them. Since
you can now have as many telnet or binary ports as you feel like,
you could just make your primary MUD port a <i>binary</i> port,
it'll let all high-ASCII characters through, and you're still
compatible with stock DGD rather than requiring patches.</p>
<hr>
<a name="StringSize" id="StringSize"></a>

<h2>Compiling DGD with a larger maximum string size</h2>

<p>By default the largest allowable string in DGD is 64kb. If you
need a larger string size you can increase it by recompiling the
driver with a couple of modifications.</p>

<p>In dgd/src/config.h, change the type of ssizet to Uint, #define
SSIZET_MAX as UINT_MAX, and #define MAX_STRLEN as what you want the
maximum string length to be.</p>

<p>Old state dump files with a smaller ssizet type can be restored
safely.</p>
<hr>
<a name="NumObjects" id="NumObjects"></a>

<h2>Compiling DGD with a larger maximum number of objects</h2>

<p>Plain vanilla DGD has a maximum of 65536 objects at once. If you
need more objects than that, you'll need to change a couple of
things in the driver source.</p>

<p>In dgd/src/config.h, you'll need "typedef unsigned int uindex;"
and "# define UINDEX_MAX UINT_MAX" in place of the previous
definitions of uindex and UINDEX_MAX. This type and constant define
how DGD handles objects, so now you should be good up to
potentially four billion objects. If you need more than that, you
should probably ask the mailing list. Alternatively, you might
notice that these are regular heavyweight objects -- LWOs don't
count. So if you're using a late-vintage 1.2.XX DGD and are willing
to have the swapping behavior do some funky things, you can
seriously cut down the number of objects by using LWOs.</p>

<p>If you fix this and still can't get enough objects, you should
check your .dgd file -- for instance, "mud.dgd" for the Kernel
MUDLib which has all your configuration information. You <i>did</i>
increase the maximum number of objects to the new limit you want,
yes?</p>
