  <titledef text="Telnet Protocol" />

  <h2> Implementing Extended Telnet Protocol in DGD </h2>

  <p>
    DGD has 'telnet ports', which implement part of the telnet
    protocol.  However, they do so in a very limited and rigid way,
    and Dworkin has no intention of extending them, or even modifying
    their behavior.  The network patch for DGD makes no change in
    this, and the ANSI color patch, while it allows certain outgoing
    high-ASCII characters, still requires patching DGD.  What should
    you do to fix this?
  </p>

  <p>
    The best answer is to implement your own telnet server in LPC and
    connect it to a DGD binary port.  This allows you to configure the
    result in LPC rather than patching DGD, and lets you send things
    like international high-ASCII characters and ANSI color codes when
    and how you like.  It also lets you handle parts of the telnet
    protocol that DGD does not, such as changes in the screen size,
    and default terminal settings.
  </p>

  <p>
    To implement the telnet protocol, you'll want to use some RFCs.
    Here are some potentially useful ones:
  </p>

  <pre>
  RFC 854 - Telnet protocol specification.
  RFC 855 - Telnet option specifications.
  1091 Telnet terminal-type option. J. VanBokkelen. Feb-01-1989.
       (Format: TXT=13439 bytes) (Obsoletes RFC0930) (Status: PROPOSED
       STANDARD)
  </pre>

  <p>
    There are bugs in how older MUD servers treat newlines, and the
    same is true of older clients.  However, the bugs seem to be all
    different and highly platform-dependent, so you'll need to work
    this one out for yourself.  Whether a telnet linefeed is
    newline-then-CR or CR-then-newline or just one or just the other
    seems to be highly platform dependent.  When in doubt, be
    tolerant.
  </p>

  <p>
    Be sure to test with a variety of telnet clients.  Even recent
    clients seem to have a variety of odd bugs in the protocol.  When
    testing, remember that some clients will even do odd things like
    detect the string &quot;password&quot; and turn off character echo
    afterward rather than relying on the server to turn off echo at
    the appropriate times.
  </p>

  <pre>
From: DGD Mailing List (Felix A. Croes)
Date: Fri Nov  1 15:43:01 2002
Subject: [DGD] Mexican Characters

Lord Lerkista wrote:

> When in a Mud i type the n-tilde character in a Unix-like terminal i 
> get a "q" as output,
> It's something of the telnet protocol that uses DGD??

It's because you are using a Mac.  DGD uses line mode for telnet clients,
and binary mode is not well-defined for line mode in the telnet protocol.
DGD uses a hack to enable it on many clients, but apparently it fails on
the Mac.

I am not planning any changes in DGD's telnet support, since even minor
changes are bound to break clients on some other platform.  Instead I am
thinking about a standard protocol for a new mud client, a version of
which I will probably release in Java.  Oh, and it will connect to the
binary port, with the protocol level on the server side handled by LPC.

Regards,
Dworkin
  </pre>

  <hr />

<pre>
From: "Felix A. Croes"
Subject: Re: [DGD] Telnet Echo / Carriage Returns
Date: Sat, 4 Sep 2004 13:43:01 +0200

Thomas Rice <thomas.rice@gmail.com> wrote:

> Hmm, I noticed I setting on my telnet client (putty) for "local line
> editing". I had it on "auto", which makes it not drop to the next line
> when I press enter. If I switch it to "force on" it will then go to
> the next line like I want.
>
> So it seems this is the option I'm looking for. :) Does anyone know
> what I need to change in the Kernel lib and/or the driver source so
> that a client with 'auto' will turn this value to on?

DGD always sends \r\n as a newline on telnet connections.  But it does
not respond to some of the more advanced settings that putty may be
attempting.  Your options are to modify dgd/src/comm.c to more fully
implement telnet option negotiation, to change putty settings instead
of DGD/LPC code, or to connect to the binary port.

Regards,
Dworkin
</pre>

<hr />

<pre>
From: Dread Quixadhal
Subject: [DGD] Re: Telnet Protocol
Date: Sun, 05 Sep 2004 18:02:54 -0400

Not too long ago, Thomas Rice claimed:

>I'm trying to build on the Kernel Lib and am trying to modify how the
>MUD treats my input when I telnet in and press enter.
>
>At the moment, after I press enter the cursor goes to the beginning of
>the line (but not down one) and then any response to what I typed is
>written over the same text.
>
>This happens with the Kernel lib I downloaded, as well as the
>Phantasmal lib I downloaded, but doesn't happen with the Gurba lib,
>but I haven't been able to figure out how to change it.
>
>  
>
and not long after that, Felix A. Croes replied:

> <>
>
>DGD always sends \r\n as a newline on telnet connections.  But it does
>not respond to some of the more advanced settings that putty may be
>attempting.  Your options are to modify dgd/src/comm.c to more fully
>implement telnet option negotiation, to change putty settings instead
>of DGD/LPC code, or to connect to the binary port.
>  
>

As usual, Dworkin answered my question before I could ask it :)

Not too long ago, I was working on a telnet class in C++ and sent mail 
to a couple of people claiming to have found the oldest and most trivial 
bug in all of DikuMUD Land... namely, if you look at the source to just 
about any of the diku variants, you'll see they send text out the socket 
with "\n\r" as the line termination characters.  According to the telnet 
specification, all transmissions in line mode must use "\r\n" as the 
line termination sequence, if you want to send the opposite, it would 
actually be sent as "\n\r\0".  The telnet server (which DGD acts as) 
will always send things in this form and expect them in this form.  It's 
up to the client (putty, your local /bin/telnet, or tinyfugue, etc...) 
to correctly translate them back and forth between the telnet spec and 
your local machine's interpretation.  Most unix-like platforms use "\n", 
most DOS-like platforms use "\r\n", and I think most pre-OSX macs use "\r".

Needless to say, reporting this bug didn't raise many red flags with 
anyone who noticed... but what Thomas describes is what I would expect 
to happen if either side (client or server) wasn't correctly honouring 
the protocol.  Besides changing settings, you might want to try another 
client as well.
</pre>

  <p style="text-size: 150%"> <a href="../index.html"> Back to top level
    </a> </p>
