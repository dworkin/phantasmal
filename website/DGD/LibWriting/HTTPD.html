<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>DGD and LPC: HTTPD</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="../../phantasmal.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table width="95%" border="0" cellspacing="0" cellpadding="4">
  <tr>
    <td colspan="2"> <table width="100%" border="0" cellspacing="1"
        cellpadding="0" class="main">
        <tr>
          <td class="banner">The DGD Driver</td>
        </tr>
      </table></td>
  </tr>
  <tr>
    <td valign="top">
      <table width="25%"  border="0" cellspacing="1"
             cellpadding="0"  class="main">
        <tr>
          <td class="content" style="font-size: 120%">

          <ul style="margin: 0; padding-left: 10%">
            <li> <a href="../index.html">DGD &amp; LPC Page</a> </li>
	    <li> <a href="../LPC">LPC Textbook</a> </li>
	    <li> <a href="../Book/html">New LPC Introduction</a> </li>
          </ul>

        </td>
        </tr>
        <tr>
          <td class="content" align="center">
            <a href="http://validator.w3.org/check/referer">
            <img src="../../images/valid-xhtml10.gif" alt="Valid XHTML 1.0!"
             style="border:0;width:88px;height:31px" /></a><br />
            <img src="../../images/pixel.gif"
             style="border:0;width:88px;height:1px" alt="" /><br />
            <a href="http://jigsaw.w3.org/css-validator/check/referer">
            <img src="http://jigsaw.w3.org/css-validator/images/vcss"
             alt="Valid CSS!" style="border:0;width:88px;height:31px" />
            </a><br /><br /><br />
            <a href="http://sourceforge.net">
            <img src="http://sourceforge.net/sflogo.php?group_id=48659&amp;type=2"
             style="border: 0; width: 125; height: 37;"
	     alt="SourceForge.net Logo" /></a>
          </td>
        </tr>
      </table></td>
    <td> <table width="100%"  border="0" cellspacing="1" cellpadding="0" 
          class="main">
        <tr>
          <td class="heading">&nbsp;&nbsp;&middot;&nbsp;
	    <a href="http://phantasmal.sf.net/DGD">DGD Page</a> &gt;
	    <a href="http://phantasmal.sf.net/DGD/LibWriting">MUDLibs</a> &gt;
            <a href="">HTTPD</a>
          </td>
        </tr>
        <tr>
          <td class="content">
  

  <h2> Writing an HTTPD in DGD </h2>

  <p>
    If you write an HTTPD that can read files in your MUD (as opposed
    to one that presents an entirely different file model, something
    it makes up), remember not to let people randomly get code out of
    your MUD directories.  Be sure to only send out the files you
    intend people to get.  Be careful to normalize filenames first
    (remove leading '..' paths, et cetera) so that nobody can fool you
    by using a different path format.  This helps to keep your HTTPD
    from causing security problems in your MUD.
  </p>

  <p>
    You can also allow players to play over HTTP, or some related
    protocol.  If so, please remember <i>not</i> to identify your
    players by IP address.  Issues like firewalls and NAT can greatly
    confuse your MUD server, causing multiple players to be treated as
    one, or a player to suddenly lose connection when he appears to
    change IP addresses.  Cookies are one of several more reliable
    tracking methods, though there are certainly others.
  </p>

  <p>
    Bear in mind that standard HTTP does not allow 'push' code for
    things like 'tell' and 'say', nor for sudden events like a
    creature entering a room and attacking.  For that reason, Java (or
    Javascript?) or some more proprietary replacement like ActiveX may
    be necessary to allow your MUD proper two-way interactivity.
  </p>

  <p>
    More complex setups can work quite well, of course.  Christopher
    Allen describes the Skotos setup like this:
  </p>

  <p style="color: #FF00C0">
    You might want to take a look at a couple of Skotos games, in
    particular, Castle Marrach and Grendel's Revenge. Both have gifs
    and jpegs under client control.
  </p>

  <p style="color: #FF00C0">
    Our basic technique is to have a pane for flowing text that is
    imbedded inside an html page. This text pane can receive special
    commands that it will send out to the DOM of the web page it sits
    inside. This allows us to change the whole web page
    dynamically. We have three clients that use this technique, an
    Active-X client that is based on Pueblo, a Java client, and a
    Mozilla Javascript client.
  </p>

  <p>
    The RFC for HTTP 1.0 is <a
    href="http://www.ics.uci.edu/pub/ietf/http/rfc1945.html">here</a>.
    It may be useful for your implementation efforts.
  </p>

  <p>
    To set cookies, you may find Javascript is useful.  The following script
    was obtained by Wes Connell off a Javascript help page:
  </p>

  <pre>
&lt;script language=&quot;JavaScript&quot;&gt;
&lt;!--

&frasl;&frasl; Use this function to retrieve a cookie.
function getCookie(name){
var cname = name + &quot;=&quot;;
var dc = document.cookie;
    if (dc.length &gt; 0) {
    begin = dc.indexOf(cname);
        if (begin != -1) {
        begin += cname.length;
        end = dc.indexOf(&quot;;&quot;, begin);
            if (end == -1) end = dc.length;
            return unescape(dc.substring(begin, end));
        }
    }
return null;
}

&frasl;&frasl; Use this function to save a cookie.
function setCookie(name, value) {
document.cookie = name + &quot;=&quot; + escape(value) + &quot;; path=&frasl;&quot;;
}

&frasl;&frasl; Use this function to delete a cookie.
function delCookie(name) {
document.cookie = name + &quot;=; expires=Thu, 01-Jan-70 00:00:01 GMT&quot; +  &quot;; path=&frasl;&quot;;
}
&frasl;&frasl;--&gt;
&lt;&frasl;script&gt;
  </pre>

  <p>
    Using the above, the following code can be included:
  </p>

  <pre>
send_html_output(&quot;&lt;script language=&quot;JavaScript&quot;&gt;);
send_html_output(&quot;setCookie(\&quot;ACCOUNTNAME\&quot;, account_name);&quot;);
send_html_output(&quot;setCookie(\&quot;PASSWORD\&quot;, encrypted_password);&quot;);
send_html_output(&quot;&lt;&frasl;script&gt;&quot;);
  </pre>

<hr />

<pre>
From: Bart van Leeuwen
Subject: [DGD] DGD http daemon?
Date: Tue Feb  8 20:58:01 2005

Hey,

Last week I rewrote a small http serving object from my mud into a
relatively complete http server.

You can see it in action by pointing your browser at http://mud.wotf.org/

Currently the code is somewhat specific to my kernel (and modified driver)
but if people are interested in this and someone is willing to help test
it for a generic DGD kernel then I can make the code available
(for non commercial use only however)

A somewhat preliminary README can be found at
http://mud.wotf.org/httpd.html, which provides some info on what it
supports and how it works.

Bart.

ps. in the next 1 1/2 weeks I'll be rather busy and away from home, I will
read my mail, but I won't be able to finish the cleaning up of the code. I do want to get an
idea on if I should put in the efford to remove dependencies on my own
kernel however.
</pre>

<hr />

<pre>
From: Joakim Romland
Subject: Re: [DGD] DGD http daemon?
Date: Wed Feb  9 00:30:01 2005

On Tue, 8 Feb 2005 15:26:53 -0500 (EST), Stephen Schmidt wrote:
> There are all kinds of design-related problems with using
> a primarily http interface for playing the game; those
> don't interest me so much. The question is really whether
> this daemon could be the basis for code support for such
> a design. If it is, then having a version for a general
> DGD kernel (or even a specific kernel that could be
> released as a package with the daemon) would be extremely
> useful.
>
I tinkered (and still touch it when I get some inspiration) with a
httpd that is built on top of the Kernel Library. It's somewhat more
bloated and should really be divided into several sub-projects. I
wrote it mostly to create a WebDAV daemon -- but I needed a httpd for
that (see SVN repository at
http://developer.berlios.de/projects/dgd-httpd/)

Either way, you can do some trickery with the xmlHttp object that is
available in most browsers these days. But as always with HTTP, you
need to do polling to get new state. Although, if you have support for
keep-alive sessions in your httpd you poll through the same connection
all the time (if you poll more often than the timeout is set to that
is).

I tested this using xmlHttp some time back using the above httpd to
write a web-chat... And sure, you get a delay of a couple of seconds
(depending on how often you poll), but to the user (browser) it is
completely invisible; eg. new information just pops up. You can poll
quite a few times per second if you want to too, but HTTP headers give
you a quite a bit of overhead. :-)

It is limited in its usefulness, but I can imagine the creative person
can come up with some nifty stuff.

If you have no idea what I am talking about, then I have relevant
snippet of the client code here (if you want the backend as well, just
drop me a mail -- it's not much code):

[ snip ]
    function createXmlHttp() {
        /* Only support for Mozilla atm. */
        return new XMLHttpRequest();
    }

    function result() {
        if(xmlHttp.readyState == 4 && xmlHttp.responseText) {
            currentBuff.innerHTML = xmlHttp.responseText;
        }
    }

    function fetch() {
        if(xmlHttp && xmlHttp.readyState != 0) {
            xmlHttp.abort();
        }

        if(xmlHttp = createXmlHttp()) {
            xmlHttp.open("GET", urlServer + urlGetPath + "?since=1", true);
            xmlHttp.onreadystatechange = result;
        } else {
            DEBUG("Failed to create xmlHttp");
        }

        xmlHttp.send(null);
    }

    function send(msg) {
        if(xmlHttp && xmlHttp.readyState != 0) {
            xmlHttp.abort();
        }

        if(xmlHttp = createXmlHttp()) {
            xmlHttp.open("GET", urlServer + urlSendPath + "?since=1&message=" +
msg, true);
            xmlHttp.onreadystatechange = result;
        } else {
            DEBUG("Failed to create xmlHttp");
        }

        xmlHttp.send(null);
    }

    function main() {
        fetch();
        setTimeout("main()", refreshRate);
    }

[ /snip ]


// Joakim
</pre>

<hr />

<pre>
From: Bart van Leeuwen
Subject: Re: [DGD] DGD http daemon?
Date: Wed Feb  9 00:43:01 2005

On Tue, 8 Feb 2005, [ISO-8859-1] Petter Nyström wrote:

> If you are releasing the code, I'd be interested in using it. I am not
> running Dworkin's kernel lib though, so I can't really help you getting a
> generic version of the code. I am just a fellow lib coder who have often
> thought it'd be nice to have an internal web server for the simpler
> purposes that have been mentioned, but I have never given the project
> priority. With your code, I can't believe there would be that much work to
> integrate it into my mudlib.

If you know how your kernel's user/connection handling is working then
you should have little trouble getting this to work on your kernel.

>
> If you put the code in public domain, let us know!

It will be available for non-commercial use once I cleaned it up a bit and
have a little bit more documentation for interfacing with it (which should
take some 2 weeks due to me being away from home for a while)

As a sidenote, there is also a project at
http://developer.berlios.de/projects/dgd-httpd/ which provides a (for what
I can tell more heavyweight) http server for DGD. If you need things like
XML parsing or webdav, take a look at that as well. What I have written is
extremely minimalistic in comparison.

Bart.
</pre>

  <p style="text-size: 150%"> <a href="../index.html"> Back to top level
    </a> </p>
            <address>
            <span><a href="mailto:angelbob-remove-spamfree@spamfree.users.sf.net">Noah Gibbs</a></span>
            </address></td>
        </tr>
      </table></td>
  </tr>
</table>
</body>
</html>
