PAGEGEN=$(ROOT)/bin/makepage.pl
BASE=$(wildcard *.base.html)
HTML=$(patsubst %.base.html,%.html,$(BASE))
DIRS_RMAKE=$(patsubst %,%_make,$(DIRS))
DIRS_RCLEAN=$(patsubst %,%_clean,$(DIRS))

export DIRS

rhtml: html msubdirs
rclean: clean csubdirs
cleancheck:
	rm -f include/*.check include/*/*.check

html: $(HTML) cleancheck

msubdirs: $(DIRS_RMAKE)
csubdirs: $(DIRS_RCLEAN)

$(DIRS_RMAKE): 
	$(MAKE) rhtml -C $(patsubst %_make,%,$@)
$(DIRS_RCLEAN): 
	$(MAKE) rclean -C $(patsubst %_clean,%,$@)

.PHONY: cleancheck msubdirs csubdirs rhtml rclean html clean $(DIRS_RMAKE) $(DIRS_RCLEAN)

clean: cleancheck
	rm -f $(HTML)

$(HTML): %.html: %.base.html $(ROOT)/template/*.html
	$(PAGEGEN) $< $(DEPTH)
